      <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="./scripts.js"></script>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css" integrity="sha384-PmY9l28YgO4JwMKbTvgaS7XNZJ30MK9FAZjjzXtlqyZCqBY6X6bXIkM++IkyinN+" crossorigin="anonymous">

        <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js" integrity="sha384-vhJnz1OVIdLktyixHY4Uk3OHEwdQqPppqYR8+5mjsauETgLOcEynD9oPHhhz18Nw" crossorigin="anonymous"></script>

        <link rel="stylesheet" href="./css/bootstrap-social.css">
        <script src="plugins/bootstrap/js/bootstrap.min.js"></script>
        <title>Firebase Auth</title>

        <script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>

        <script src="https://cdnjs.cloudflare.com/ajax/libs/node-uuid/1.4.8/uuid.js"></script>

        <script>
          var config = {
            apiKey: "AIzaSyAtaDx6v3Q4yNAQVMe-z88v-64YKRTCOrQ",
            authDomain: "cs493-14e09.firebaseapp.com",
            databaseURL: "https://cs493-14e09.firebaseio.com",
            projectId: "cs493-14e09",
            storageBucket: "cs493-14e09.appspot.com",
            messagingSenderId: "276297056112"
        };
        firebase.initializeApp(config);
      </script>

      <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>

      <script>
        var currentFileName, currentTitle, currentText;

        $(document).ready(function(event) {
          getCurrentUser();
        })

        function addNote() {
          var uuid1 = uuid();
          var noteTitle = document.getElementById("noteTitleField").value;
          var noteText = document.getElementById("noteTextField").value;
          firebase.database().ref(`${firebase.auth().currentUser.uid}/notes/${uuid1}`).set({
            title: `${noteTitle}`,
            text: `${noteText}`,
          })

          document.getElementById("noteTitleField").value = "";
          document.getElementById("noteTextField").value = "";
        }

        function readNotes() {
          firebase.database().ref(`${firebase.auth().currentUser.uid}/notes/`).on('value', posts => {
            notes = posts.val();

            document.getElementById("notesList").innerHTML = "";

            Object.keys(notes).map((j, i) => {
              var data = `<div class="card-body" id="${j}" onclick=openNote(event) data-toggle="modal" data-target="#noteModal" style="background: white; padding: 3 0 3 0;"><h4 class="text-center card-text">${notes[j].title}</h4></div><br>`
              document.getElementById("notesList").innerHTML += data;
            })
          })
        }

        function openNote(event) {
          event.preventDefault();

          document.getElementById("modal_noteTitle").innerHTML = `${notes[event.currentTarget.id].title}`;
          document.getElementById("modal_noteText").innerHTML = `${notes[event.currentTarget.id].text}`;

          currentTitle = `${notes[event.currentTarget.id].title}`
          currentText = `${notes[event.currentTarget.id].text}`
          currentFileName = `${notes[event.currentTarget.id].image}`

          $('#noteModal').data('postId', `${event.currentTarget.id}`)

          refreshFiles($('#noteModal').data('postId'));

          console.log($('#noteModal').data('postId'));

        }

        function refreshFiles(id) {
          readNotes();
          var image = `${notes[id].image}`
          let storageRef = firebase.storage().ref();
          let folderRef = storageRef.child(`${firebase.auth().currentUser.uid}/files/${$('#noteModal').data('postId')}`)

          document.getElementById("modal_files").innerHTML = "";

          folderRef.child(`/${image}`).getDownloadURL().then(function (url) {
            console.log(url);
            document.getElementById("modal_files").innerHTML = `<img id="modal_img" src="${url}" style="width: 100%; height: 50%;"</img>`;
          }).catch(err => {
            console.log(err)
          });
        }

        function deleteNote(id) {
          firebase.database().ref(`${firebase.auth().currentUser.uid}/notes/${id}`).remove();
          readNotes();
        }

        function editWindow() {
          document.getElementById("editNoteTitleField").value = `${notes[$('#noteModal').data('postId')].title}`;
          document.getElementById("editNoteTextField").value = `${notes[$('#noteModal').data('postId')].text}`;
        }

        function editNote() {
          let noteTitle = document.getElementById("editNoteTitleField").value;
          let noteText = document.getElementById("editNoteTextField").value;
          let uuid = $('#noteModal').data('postId');

          console.log(uuid);

          firebase.database().ref(`${firebase.auth().currentUser.uid}/notes/${uuid}`).set({
            title: `${noteTitle}`,
            text: `${noteText}`,
            image: `${currentFileName}`,
          })

          currentText = noteText;
          currentTitle = noteTitle;

          readNotes();
        }

        function uploadFile(files) {
          let storageRef = firebase.storage().ref();
          let file = files[0];
          let uuid = $('#noteModal').data('postId');

          let fileRef = storageRef.child(`${firebase.auth().currentUser.uid}/files/${$('#noteModal').data('postId')}/${file.name}`);

          fileRef.put(file).then(function() {
            console.log('File successfully uploaded!');
            console.log(file);

            firebase.database().ref(`${firebase.auth().currentUser.uid}/notes/${uuid}`).set ({
              title: `${currentTitle}`,
              text: `${currentText}`,
              image: file.name
            });

            currentFileName = file.name

            refreshFiles($('#noteModal').data('postId'));

          }).catch(err => {
            console.log(err);
          });
        }

      </script>
    </head>

      <div class="modal fade" id="addNoteModal">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-title text-center">
              <h2>Add New Note</h2>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="inputNoteTitle">Note Title</label>
                <input class="form-control" id="noteTitleField" placeholder="Title">
              </div>
              <div class="form-group">
                <label for="inputNoteText">Note Text</label>
                <textarea class="form-control" id="noteTextField" placeholder="Text" rows="4"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" data-dismiss="modal" style="display: inline;">Close</button>
              <button class="btn btn-primary center-block" onclick="addNote()" data-dismiss="modal" style="display: inline;">Submit</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="editNoteModal" data-postId="">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-title text-center">
              <h2>Edit Note</h2>
            </div>
            <div class="modal-body">
              <div class="form-group">
                <label for="inputNoteTitle">Note Title</label>
                <input class="form-control" id="editNoteTitleField" placeholder="Title">
              </div>
              <div class="form-group">
                <label for="inputNoteText">Note Text</label>
                <textarea class="form-control" id="editNoteTextField" placeholder="Text" rows="4"></textarea>
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" data-dismiss="modal" style="display: inline;">Close</button>
              <button class="btn btn-primary center-block" onclick="editNote()" data-dismiss="modal" style="display: inline;">Submit</button>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="noteModal" data-postId="">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-title text-center">
              <h2 id="modal_noteTitle">Modal Note Title</h2>
            </div>
            <div class="modal-body">
              <h2 id="modal_noteText" class="text-center">Modal Note Text</h2>
              <div id="modal_files">
              </div>
            </div>
            <div class="modal-footer">
              <button class="btn btn-primary" data-dismiss="modal" style="display: inline;">Close</button>
              <button class="btn btn-primary" data-dismiss="modal" onclick="deleteNote($('#noteModal').data('postId'))" style="display: inline;">Delete</button>
              <button class="btn btn-primary" data-dismiss="modal" data-toggle="modal" data-target="#editNoteModal" onclick="editWindow()"style="display: inline;">Edit</button>
              <div class="form-group" style="float: left;">
              <label for="file-upload">Upload a File</label>
              <input id="file-upload" type="file" onchange="uploadFile(this.files)"style="display: inline;"/>
            </div>
            </div>
          </div>
        </div>
      </div>

      <div class="container" style="margin: 50 auto; width: 50%;">
        <div class="jumbotron">
          <form class="form-inline text-center">
          </form>
          <br>
          <div class="text-center">
            <h2 id="email">User Email</h2>
            <br>
            <h2 id="name">Display Name</h2>
        </div>
          <br>
        </div>
      </div>

      <h2 class="text-center">Notes</h2>
      <div class="container" style="margin: 50 auto; width: 50%">
        <div class="jumbotron" id="notesList">
          <div class="card-body" style="background: white; padding: 3 0 3 0;">
            <h4 class="text-center card-text">Note 1</h4>
          </div>
          <br>
          <div class="card-body" style="background: white; padding: 3 0 3 0;">
            <h4 class="text-center card-text">Note 2</h4>
          </div>
        </div>
        <button type="button" class="btn btn-primary center-block" id="addNoteButton" data-toggle="modal" data-target="#addNoteModal">Create New Note</button>
      </div>
